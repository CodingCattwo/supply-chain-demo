{"remainingRequest":"/Users/lannywu/A2021/06/0616/supply-chain-demo/frontend/supplychain/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lannywu/A2021/06/0616/supply-chain-demo/frontend/supplychain/src/views/create/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/lannywu/A2021/06/0616/supply-chain-demo/frontend/supplychain/src/views/create/index.vue","mtime":1623815030939},{"path":"/Users/lannywu/A2021/06/0616/supply-chain-demo/frontend/supplychain/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lannywu/A2021/06/0616/supply-chain-demo/frontend/supplychain/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/lannywu/A2021/06/0616/supply-chain-demo/frontend/supplychain/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lannywu/A2021/06/0616/supply-chain-demo/frontend/supplychain/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGdldFBhcnRpY2lwYXRlcklkLCBnZXRVc2VySWQgfSBmcm9tICJAL3V0aWxzL2F1dGgiOwppbXBvcnQgeyBnZXRTZWxlY3RMaXN0LCBjcmVhdGVDaGFpbiB9IGZyb20gIkAvYXBpL3RhYmxlIjsKaW1wb3J0IHV1aWR2NCBmcm9tICJ1dWlkL3Y0IjsKZXhwb3J0IGRlZmF1bHQgewogIGRhdGEoKSB7CiAgICBjb25zdCBpc0RlY2ltYWwgPSAocnVsZSwgdmFsdWUsIGNhbGxiYWNrKSA9PiB7CiAgICAgIGNvbnN0IHJlZyA9IC9eKFsxXT9cZHsxLDJ9KSQvOwogICAgICBpZiAoIXJlZy50ZXN0KHZhbHVlKSkgewogICAgICAgIGNhbGxiYWNrKG5ldyBFcnJvcigi6K+36L6T5YWlMS0xMDDkuYvpl7TmlbTmlbAiKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY2FsbGJhY2soKTsKICAgICAgfQogICAgfTsKICAgIHJldHVybiB7CiAgICAgIGNyZWF0ZVJ1bGVzOiB7CiAgICAgICAgdGl0bGU6IFt7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAi6K+36L6T5YWl5qCH6aKYIiwgdHJpZ2dlcjogImJsdXIiIH1dLAogICAgICAgIGRlc2M6IFt7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAi6K+36L6T5YWl5o+P6L+wIiwgdHJpZ2dlcjogImJsdXIiIH1dLAogICAgICAgIHJvbGU6IFt7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAi6K+36L6T5YWl6KeS6ImyIiwgdHJpZ2dlcjogImJsdXIiIH1dLAogICAgICAgIHBvcnRpb246IFt7IHZhbGlkYXRvcjogaXNEZWNpbWFsLCB0cmlnZ2VyOiAiYmx1ciIgfV0sCiAgICAgICAgcGFydGljaXBhdGVySWQ6IFsKICAgICAgICAgIHsgcmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICLor7fpgInmi6nlj4LkuI7ogIUiLCB0cmlnZ2VyOiAiYmx1ciIgfQogICAgICAgIF0KICAgICAgfSwKICAgICAgdGVzdDogIiIsCiAgICAgIHJvbGVMaXN0OiBbXSwKCiAgICAgIGxldmVsOiAxLAogICAgICBuZXh0VXVpZDogIiIsCiAgICAgIGR5bmFtaWNWYWxpZGF0ZUZvcm06IHsKICAgICAgICBpdGVtTGlzdDogWwogICAgICAgICAgewogICAgICAgICAgICBpZDogIiIsCiAgICAgICAgICAgIHJvbGU6ICIiLAogICAgICAgICAgICBwb3J0aW9uOiAiIiwKICAgICAgICAgICAgaXRlbUlkOiB0aGlzLmNyZWF0ZVV1aWQoKSwKICAgICAgICAgICAgbGV2ZWxPbkNoYWluOiAwLAogICAgICAgICAgICBpc1NlbGVjdDogdHJ1ZSwKICAgICAgICAgICAgcGFydGljaXBhdGVySWQ6ICIiCiAgICAgICAgICB9CiAgICAgICAgXSwKICAgICAgICB0aXRsZTogIiIsCiAgICAgICAgdXNlcklkOiAiIgogICAgICB9CiAgICB9OwogIH0sCiAgY3JlYXRlZCgpIHsKICAgIHRoaXMuZ2V0U2VsZXREYXRhKCk7CiAgfSwKICBtZXRob2RzOiB7CiAgICBjcmVhdGVVdWlkKCkgewogICAgICBsZXQgdXVpZCA9IHV1aWR2NCgpOwogICAgICB1dWlkID0gdXVpZC5zcGxpdCgiLSIpLmpvaW4oIiIpOwogICAgICByZXR1cm4gdXVpZDsKICAgIH0sCiAgICBnZXRTZWxldERhdGEoKSB7CiAgICAgIGNvbnN0IHVzZXJJZCA9IGdldFVzZXJJZCgpOwogICAgICBjb25zdCBwSWQgPSBnZXRQYXJ0aWNpcGF0ZXJJZCgpOwogICAgICB0aGlzLmR5bmFtaWNWYWxpZGF0ZUZvcm0udXNlcklkID0gdXNlcklkOwogICAgICB0aGlzLnByZVV1aWQgPSB0aGlzLmR5bmFtaWNWYWxpZGF0ZUZvcm0uaXRlbUxpc3RbMF0uaXRlbUlkOwogICAgICBnZXRTZWxlY3RMaXN0KCkudGhlbihyZXMgPT4gewogICAgICAgIHRoaXMucm9sZUxpc3QgPSByZXMuZGF0YTsKICAgICAgICB0aGlzLnJvbGVMaXN0LmZvckVhY2goaXRlbSA9PiB7CiAgICAgICAgICBpZiAoaXRlbS5pZCA9PSBwSWQpIHsKICAgICAgICAgICAgdGhpcy5keW5hbWljVmFsaWRhdGVGb3JtLml0ZW1MaXN0WzBdLmlkID0gaXRlbS5pZDsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgc3VibWl0Rm9ybShmb3JtTmFtZSkgewogICAgICB0aGlzLiRyZWZzW2Zvcm1OYW1lXS52YWxpZGF0ZSh2YWxpZCA9PiB7CiAgICAgICAgaWYgKHZhbGlkKSB7CiAgICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5keW5hbWljVmFsaWRhdGVGb3JtLml0ZW1MaXN0OwogICAgICAgICAgbGV0IHRvdGFsUmF0aW8gPSBkYXRhLnJlZHVjZSgocHJldiwgY3VyKSA9PiB7CiAgICAgICAgICAgIHJldHVybiBwYXJzZUZsb2F0KGN1ci5wb3J0aW9uKSArIHBhcnNlRmxvYXQocHJldik7CiAgICAgICAgICB9LCAwKTsKCiAgICAgICAgICBpZiAodG90YWxSYXRpbyAhPT0gMTAwKSB7CiAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgICAgIG1lc3NhZ2U6ICLor7fovpPlhaXmraPnoa7nmoTku73pop0iLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGxldCBhcnJheUlkID0gW107CiAgICAgICAgICAgIGRhdGEuZm9yRWFjaChpdGVtID0+IHsKICAgICAgICAgICAgICBhcnJheUlkLnB1c2goaXRlbS5pZCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjb25zdCBub1JlcGVhdElkID0gWy4uLm5ldyBTZXQoYXJyYXlJZCldOwoKICAgICAgICAgICAgaWYgKGFycmF5SWQubGVuZ3RoID09PSBub1JlcGVhdElkLmxlbmd0aCkgewogICAgICAgICAgICAgIHRoaXMuZHluYW1pY1ZhbGlkYXRlRm9ybS5pdGVtTGlzdC5mb3JFYWNoKGl0ZW0gPT4gewogICAgICAgICAgICAgICAgaXRlbS5wYXJ0aWNpcGF0ZXJJZCA9IGl0ZW0uaWQ7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgY3JlYXRlQ2hhaW4odGhpcy5keW5hbWljVmFsaWRhdGVGb3JtKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICBpZiAocmVzLmNvZGUgPT09IDApIHsKICAgICAgICAgICAgICAgICAgdGhpcy4kY29uZmlybSgi5o+Q5Lqk5oiQ5YqfIiwgIuaPkOS6pOaIkOWKnyIsIHsKICAgICAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogIui/lOWbniIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGNsb3NlT25DbGlja01vZGFsOiBmYWxzZQogICAgICAgICAgICAgICAgICB9KS50aGVuKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7IHBhdGg6ICIvbGlzdCIgfSk7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgICAgICAgbWVzc2FnZTogIuWPguS4juiAheS4jeiDvemHjeWkjemAieaLqSIsCiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCJlcnJvciBzdWJtaXQhISIpOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgcmVzZXRGb3JtKGZvcm1OYW1lKSB7CiAgICAgIHRoaXMuJHJlZnNbZm9ybU5hbWVdLnJlc2V0RmllbGRzKCk7CiAgICB9LAogICAgcmVtb3ZlQ2hhaW4oaXRlbSkgewogICAgICB2YXIgaW5kZXggPSB0aGlzLmR5bmFtaWNWYWxpZGF0ZUZvcm0uaXRlbUxpc3QuaW5kZXhPZihpdGVtKTsKICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgIHRoaXMuZHluYW1pY1ZhbGlkYXRlRm9ybS5pdGVtTGlzdC5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CiAgICB9LAogICAgYWRkQ2hhaW4oKSB7CiAgICAgIHRoaXMuZHluYW1pY1ZhbGlkYXRlRm9ybS5pdGVtTGlzdC5wdXNoKHsKICAgICAgICBwYXJ0aWNpcGF0ZXJJZDogIiIsCiAgICAgICAgcm9sZTogIiIsCiAgICAgICAgcG9ydGlvbjogIiIsCiAgICAgICAgbGV2ZWxPbkNoYWluOiB0aGlzLmxldmVsKyssCiAgICAgICAgaXRlbUlkOiB0aGlzLmNyZWF0ZVV1aWQoKSwKICAgICAgICBsYXN0SXRlbUlkOiB0aGlzLnByZVV1aWQsCiAgICAgICAgaXNTZWxlY3Q6IGZhbHNlCiAgICAgIH0pOwogICAgICBjb25zdCBwcmVJbmRleCA9IHRoaXMuZHluYW1pY1ZhbGlkYXRlRm9ybS5pdGVtTGlzdC5sZW5ndGggLSAxOwogICAgICB0aGlzLnByZVV1aWQgPSB0aGlzLmR5bmFtaWNWYWxpZGF0ZUZvcm0uaXRlbUxpc3RbcHJlSW5kZXhdLml0ZW1JZDsKICAgIH0KICB9Cn07Cg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/create","sourcesContent":["<template>\n  <div>\n    <div class=\"create-form\">\n      <el-form\n        :model=\"dynamicValidateForm\"\n        :rules=\"createRules\"\n        ref=\"dynamicValidateForm\"\n        label-width=\"100px\"\n        class=\"demo-dynamic\"\n      >\n        <el-form-item prop=\"title\" label=\"标题\">\n          <el-input v-model=\"dynamicValidateForm.title\"></el-input>\n        </el-form-item>\n        <el-form-item prop=\"desc\" label=\"描述\">\n          <el-input v-model=\"dynamicValidateForm.desc\"></el-input>\n        </el-form-item>\n        <el-form-item\n          class=\"demo-form-inline\"\n          v-for=\"(chain, index) in dynamicValidateForm.itemList\"\n          :label=\"'参与方' + index\"\n          :key=\"chain.key\"\n        >\n          <el-row>\n            <el-col :span=\"8\">\n              <el-form-item\n                label=\"\"\n                :prop=\"'itemList.' + index + '.role'\"\n                :rules=\"createRules.role\"\n              >\n                <el-input v-model=\"chain.role\" placeholder=\"角色\"></el-input>\n              </el-form-item>\n            </el-col>\n            <el-col :span=\"8\">\n              <el-form-item\n                label=\"\"\n                :prop=\"'itemList.' + index + '.portion'\"\n                :rules=\"createRules.portion\"\n              >\n                <el-input\n                  type=\"number\"\n                  maxlength=\"2\"\n                  v-model=\"chain.portion\"\n                  placeholder=\"份额\"\n                >\n                  <template slot=\"append\">%</template>\n                </el-input>\n              </el-form-item>\n            </el-col>\n            <el-col :span=\"8\">\n              <el-form-item\n                label=\"\"\n                :prop=\"'itemList.' + index + '.id'\"\n                :rules=\"createRules.id\"\n              >\n                <el-select\n                  v-model=\"chain.id\"\n                  placeholder=\"参与者\"\n                  :disabled=\"chain.isSelect\"\n                >\n                  <template>\n                    <el-option\n                      v-for=\"item in roleList\"\n                      :label=\"item.orgName\"\n                      :value=\"item.id\"\n                      :key=\"item.id\"\n                    ></el-option>\n                  </template>\n                </el-select>\n              </el-form-item>\n            </el-col>\n          </el-row>\n          <!--  <el-button @click.prevent=\"removeChain(chain)\">删除</el-button> -->\n        </el-form-item>\n        <el-form-item>\n          <el-button type=\"primary\" @click=\"submitForm('dynamicValidateForm')\"\n            >提交</el-button\n          >\n          <el-button @click=\"addChain\">新增</el-button>\n          <!--  <el-button @click=\"resetForm('dynamicValidateForm')\">重置</el-button> -->\n        </el-form-item>\n      </el-form>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { getParticipaterId, getUserId } from \"@/utils/auth\";\nimport { getSelectList, createChain } from \"@/api/table\";\nimport uuidv4 from \"uuid/v4\";\nexport default {\n  data() {\n    const isDecimal = (rule, value, callback) => {\n      const reg = /^([1]?\\d{1,2})$/;\n      if (!reg.test(value)) {\n        callback(new Error(\"请输入1-100之间整数\"));\n      } else {\n        callback();\n      }\n    };\n    return {\n      createRules: {\n        title: [{ required: true, message: \"请输入标题\", trigger: \"blur\" }],\n        desc: [{ required: true, message: \"请输入描述\", trigger: \"blur\" }],\n        role: [{ required: true, message: \"请输入角色\", trigger: \"blur\" }],\n        portion: [{ validator: isDecimal, trigger: \"blur\" }],\n        participaterId: [\n          { required: true, message: \"请选择参与者\", trigger: \"blur\" }\n        ]\n      },\n      test: \"\",\n      roleList: [],\n\n      level: 1,\n      nextUuid: \"\",\n      dynamicValidateForm: {\n        itemList: [\n          {\n            id: \"\",\n            role: \"\",\n            portion: \"\",\n            itemId: this.createUuid(),\n            levelOnChain: 0,\n            isSelect: true,\n            participaterId: \"\"\n          }\n        ],\n        title: \"\",\n        userId: \"\"\n      }\n    };\n  },\n  created() {\n    this.getSeletData();\n  },\n  methods: {\n    createUuid() {\n      let uuid = uuidv4();\n      uuid = uuid.split(\"-\").join(\"\");\n      return uuid;\n    },\n    getSeletData() {\n      const userId = getUserId();\n      const pId = getParticipaterId();\n      this.dynamicValidateForm.userId = userId;\n      this.preUuid = this.dynamicValidateForm.itemList[0].itemId;\n      getSelectList().then(res => {\n        this.roleList = res.data;\n        this.roleList.forEach(item => {\n          if (item.id == pId) {\n            this.dynamicValidateForm.itemList[0].id = item.id;\n          }\n        });\n      });\n    },\n    submitForm(formName) {\n      this.$refs[formName].validate(valid => {\n        if (valid) {\n          const data = this.dynamicValidateForm.itemList;\n          let totalRatio = data.reduce((prev, cur) => {\n            return parseFloat(cur.portion) + parseFloat(prev);\n          }, 0);\n\n          if (totalRatio !== 100) {\n            this.$message({\n              message: \"请输入正确的份额\",\n              type: \"warning\"\n            });\n          } else {\n            let arrayId = [];\n            data.forEach(item => {\n              arrayId.push(item.id);\n            });\n            const noRepeatId = [...new Set(arrayId)];\n\n            if (arrayId.length === noRepeatId.length) {\n              this.dynamicValidateForm.itemList.forEach(item => {\n                item.participaterId = item.id;\n              });\n              createChain(this.dynamicValidateForm).then(res => {\n                if (res.code === 0) {\n                  this.$confirm(\"提交成功\", \"提交成功\", {\n                    confirmButtonText: \"返回\",\n                    type: \"success\",\n                    showCancelButton: false,\n                    closeOnClickModal: false\n                  }).then(() => {\n                    this.$router.push({ path: \"/list\" });\n                  });\n                }\n              });\n            } else {\n              this.$message({\n                message: \"参与者不能重复选择\",\n                type: \"error\"\n              });\n              return;\n            }\n          }\n        } else {\n          console.log(\"error submit!!\");\n          return false;\n        }\n      });\n    },\n    resetForm(formName) {\n      this.$refs[formName].resetFields();\n    },\n    removeChain(item) {\n      var index = this.dynamicValidateForm.itemList.indexOf(item);\n      if (index !== -1) {\n        this.dynamicValidateForm.itemList.splice(index, 1);\n      }\n    },\n    addChain() {\n      this.dynamicValidateForm.itemList.push({\n        participaterId: \"\",\n        role: \"\",\n        portion: \"\",\n        levelOnChain: this.level++,\n        itemId: this.createUuid(),\n        lastItemId: this.preUuid,\n        isSelect: false\n      });\n      const preIndex = this.dynamicValidateForm.itemList.length - 1;\n      this.preUuid = this.dynamicValidateForm.itemList[preIndex].itemId;\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\">\n.create-form {\n  width: 70%;\n  height: 900px;\n  margin: 40px auto;\n  .el-col .el-form-item__content,\n  .el-input input {\n    margin-left: 10px;\n  }\n  .el-col .el-input input {\n    margin-left: 0;\n  }\n  .el-select {\n    display: block;\n  }\n}\n</style>\n"]}]}